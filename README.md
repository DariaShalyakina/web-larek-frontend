# Проектная работа "Веб-ларек"

# Описание проекта

Проект представляет собой набор компонентов и интерфейсов для работы с интернет-магазином. В проекте реализованы компоненты для отображения каталога товаров, корзины, модального окна, страницы заказа и других элементов интерфейса.

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Описание

## Архитектура

Приложение реализовано по MVP архитектуре и состоит из:

### Model

Отвечает за хранение и обработку данных, базовым является класс **`Model`**

**Связанные классы:**

- AppAPI
- AppState
- Order

### View

Отвечает за отображение данных и взаимодействие с пользователем: базовый класс **`Component<T>`**

**Связанные классы:**

- Page
- Modal
- Form
- ProductCard
- Basket
- ProductInBasket
- Contacts
- Success

### Presenter

Отвечает за связь между Model и View, а также за обновление состояния при изменении данных и реализуется она в файле `index.ts`

# Описание слой View

## 1. Component<T>

**Описание**

`Component<T>` - это абстрактный базовый класс для всех компонентов в приложении. Он предоставляет следующие возможности:

**Конструктор:**
Конструктор принимает корневой элемент компонента HTML и должен вызываться всеми дочерними классами.

- container: Корневой элемент компонента в DOM.

**Методы работы с DOM:**
Component предоставляет несколько методов для упрощения взаимодействия с DOM, таких как `toggleClass`, `setText` и `setDisabled`.

**Метод render:**
Этот метод должен переопределяться дочерними классами и возвращать корневой элемент DOM компонента.

## 2. Page

**Описание:**
Класс Page отвечает за отрисовку общей структуры страницы и обработку глобальных событий.

**Интерфейс:**

```
interface IPage {
   counter: number; // Счетчик товаров в корзине
   catalog: HTMLElement[]; // Список элементов каталога
   locked: boolean; // Флаг блокировки страницы
}
```

**Свойства:**

- counter: Количество товаров в корзине.
- catalog: Массив элементов каталога.
- locked: Флаг, указывающий, заблокирована ли страница.
- basket: ссылка на элемент корзины.

**Конструктор:**

constructor(container: HTMLElement, events: IEvents)

- container: Корневой элемент компонента в DOM. Он будет использоваться для отображения компонента.
- events: Экземпляр класса IEvents, который предоставляет возможности для подписки и вызова событий. Он используется для взаимодействия компонента с другими частями приложения через события.

**Методы:**

- set counter(value: number): Устанавливает значение счетчика товаров в корзине.
- set catalog(items: HTMLElement[]): Устанавливает массив элементов каталога.
- set locked(value: boolean): Устанавливает флаг блокировки страницы.

**Обработчики событий:**

- Компонент обрабатывает событие клика по элементу с классом `header__basket` и вызывает событие `bids:open` в объекте событий events.

## 3. ProductCard

**Описание:**
Класс ProductCard отвечает за отрисовку карточки товара.

**Интерфейс:**

```
interface IProduct {
  id: string;
  title: string;
  description?: string;
  image?: string;
  category: string;
  price: number | null;
}
```

```
interface IProductCardActions {
  onClick: (event: MouseEvent) => void;
}
```

**Свойства:**

- id: Уникальный идентификатор товара.
- title: Название товара.
- description: Описание товара (необязательно).
- image: Ссылка на изображение товара (необязательно).
- category: Категория товара.
- price: Цена товара (может быть null).
- data: внутреннее свойство, содержащее данные продукта, связанные с карточкой.

**Конструктор:**

constructor(container: HTMLElement, actions?: IProductCardActions)

- container: Корневой элемент компонента в DOM. Он будет использоваться для отображения компонента.
- actions?: Необязательный объект, содержащий функции обратного вызова для обработки действий, связанных с карточкой товара.

**Методы:**

- set id(value: string): Устанавливает идентификатор товара.
- get id(): string: Возвращает идентификатор товара.
- set title(value: string): Устанавливает название товара.
- get title(): string: Возвращает название товара.
- set image(value: string): Устанавливает ссылку на изображение товара.
- set price(value: number | null): Устанавливает цену товара.
- set category(value: string): Устанавливает категорию товара.

**Обработчики событий:**
Если в конструктор передается объект с колбэк-функцией onClick, она добавляется как обработчик события клика по кнопке добавления товара в корзину или по самой карточке товара, если кнопки нет.

## 4. Basket

**Описание:**
Класс Basket отвечает за отображение содержимого корзины и обработку событий, связанных с ней.

**Интерфейс:**

```
interface IBasketView {
    items: HTMLElement[];
    total: number;
    selected: string[];
}
```

**Свойства:**

- items: Массив элементов, представляющих товары в корзине.
- total: Общая сумма заказа.

**Конструктор:**
Конструктор компонента, который принимает контейнер и объект событий.

constructor(container: HTMLElement, events: EventEmitter)

- container: Он будет использоваться для отображения компонента.
- events: Экземпляр класса EventEmitter, который предоставляет возможности для подписки и вызова событий. Он используется для взаимодействия компонента с другими частями приложения через события.

**Методы:**

- set items(items: HTMLElement[]): Устанавливает массив элементов товаров в корзине;
- set selected(items: string[]): Сеттер для установки состояния кнопки оформления заказа;
- set total(total: number): устанавливает итоговую сумму корзины.
	

**Обработчики событий:**
Компонент обрабатывает событие клика по кнопке оформления заказа и вызывает событие `order:open` в объекте событий events.

## 5. ProductInBasket
Класс ProductInBasket расширяет компонент Component и представляет отдельный продукт в корзине. 

```
interface IProductInBasket extends IProduct {
	index: number;
}
```

Он имеет следующие защищенные поля:
_index: HTML-элемент, содержащий индекс продукта в корзине.
_title: HTML-элемент, содержащий заголовок продукта.
_price: HTML-элемент, содержащий цену продукта.
_button: HTML-элемент, представляющий кнопку для удаления продукта из корзины.
Конструктор 
принимает контейнер HTML-элемента, в котором расположен продукт, и необязательные действия actions. Если определены actions, к кнопке добавляется обработчик событий click, который удаляет продукт из DOM и вызывает метод onClick из actions.

Сеттеры 
title, 
index 
price устанавливают соответствующие значения в элементы HTML.



## 6. Modal

**Описание:**
Класс Modal отвечает за отображение модальных окон.

**Интерфейс:**

```
interface IModalData {
	content: HTMLElement;
	product?: IProduct;
}
```

**Свойства:**

- content: Содержимое модального окна.
- product: Объект товара, связанный с модальным окном (необязательно).

**Конструктор:**
Конструктор компонента, который принимает контейнер или его селектор.

- constructor(container: HTMLElement | string)

**Методы:**

- set content(value: HTMLElement): Свойство для установки содержимого модального окна.
- open(data?: IModalData): Открывает модальное окно и отрисовывает переданное содержимое.
- close(): Закрывает модальное окно и удаляет его содержимое.
- render(data: IModalData): HTMLElement: Отрисовывает переданное содержимое в модальное окно и возвращает контейнер модального окна.

**Обработчики событий:**

- Клик по кнопке закрытия модального окна
- Клик по фону модального окна (кроме содержимого)

## 7. Form<T>

**Описание:**
Класс Form<T> представляет собой основу для создания различных форм в приложении.

**Интерфейс:**

```
interface IForm {
	valid: boolean; // Валидность формы.
	errors: string[]; // Ошибки при заполнении формы.
}
```

**Свойства:**

- valid: Флаг, указывающий, валидна ли форма.
- errors: Массив строк, содержащих сообщения об ошибках в форме.

**Конструктор:**
Конструктор компонента, который принимает контейнер формы и объект событий.

constructor(container: HTMLFormElement, events: IEvents)

- container: Корневой элемент компонента в DOM. Он будет использоваться для отображения компонента.
- events: Экземпляр класса IEvents, который предоставляет возможности для подписки и вызова событий. Он используется для взаимодействия компонента с другими частями приложения через события.

**Методы:**

- onInputChange(field: keyof T, value: string): Обработчик события изменения полей формы.
- set valid(value: boolean): Устанавливает значение свойства valid.
- set errors(value: string[]): Устанавливает значение свойства errors.
- render(state: Partial<T> & IForm): HTMLFormElement: Отрисовывает форму.

**Обработчики событий:**
Класс обрабатывает следующие события:

- input: Вызывается при изменении значения поля формы.
- submit: Вызывается при отправке формы.

## 8. Contacts

Расширяет класс **Form<T>** и предоставляет дополнительную функциональность для работы с формой контактов:

**Интерфейс:**

```
interface IContactsForm {
    email: string;
	phone: string;
}
```

**Конструктор:**

constructor(container: HTMLFormElement, events: IEvents)

- container: Корневой элемент компонента в DOM. Он будет использоваться для отображения компонента.
- events: Экземпляр класса IEvents, который предоставляет возможности для подписки и вызова событий. Он используется для взаимодействия компонента с другими частями приложения через события.

**Методы:**

- Сеттер `phone`: устанавливает значение поля ввода с именем "phone" в контейнере формы.
- Сеттер `email`: устанавливает значение поля ввода с именем "email" в контейнере формы.

## 9. Success

**Описание:**
Класс Success отображает сообщение об успешном выполнении действия, например об удачном завершении заказа.

**Интерфейс:**

```
export interface ISuccess {
    id: string;
	  total: number;
}
```

**Свойства:**

- total: количество списанных синапсов.

**Конструктор:**

Конструктор компонента, который принимает контейнер и объект с колбэк-функциями.

- constructor(container: HTMLElement, actions?: ISuccessActions)

* container: Корневой элемент компонента в DOM. Он будет использоваться для отображения компонента.
* actions?: Необязательный объект, содержащий функции обратного вызова для обработки действий, связанных с карточкой товара.

**Методы:**

- set total (total: string): Устанавливает описание успешного действия.

**Обработчики событий:**
Класс обрабатывает событие клика по кнопке закрытия сообщения, если она есть.

# Описание слой Model

## 1. Model

Model - это абстрактный базовый класс, который служит для отделения моделей от обычных объектов данных.
Он предоставляет следующие возможности:

**Конструктор:**
Конструктор принимает:

- data: Необязательный объект с начальными данными для модели.
- events: Экземпляр класса IEvents, используемый для взаимодействия с другими частями приложения через события.

## 2. Order

**Описание:**
Класс Order отвечает за отображение и обработку формы заказа.

**Интерфейс:**

```
interface IOrderForm {
   payment: 'online' | 'cash' | null;
   address: string;
   email: string;
   phone: string;
}
```

**Свойства:**

- payment: Способ оплаты ('online', 'cash' или null).
- _payment: Массив элементов HTMLButtonElement, представляющих доступные варианты оплаты.
- address: Адрес доставки.

**Конструктор:**

Конструктор компонента, который принимает контейнер формы и объект событий
constructor(container: HTMLFormElement, events: IEvents)

- container: Корневой элемент компонента в DOM. Он будет использоваться для отображения компонента.
- events: Экземпляр класса IEvents, который предоставляет возможности для подписки и вызова событий. Он используется для взаимодействия компонента с другими частями приложения через события.

**Методы:**

- updatePaymentButtons(): Обновляет стили кнопок оплаты.
- handleNextButtonClick(): Обрабатывает нажатие на кнопку "Далее".
- set payment(value: string): Сеттер для свойства payment.
- set address(value: string): Сеттер для свойства address.

**Обработчики событий:**
**Класс обрабатывает следующие события:**

- Клик по кнопкам оплаты
- Клик по кнопке "Далее"

## 3. AppState

Класс AppState используется как центральное хранилище состояния для приложения. Он предоставляет единый доступ к данным о товарах, корзине и заказе клиента, что позволяет различным компонентам приложения работать с этими данными согласованно.
Он управляет списком товаров в корзине (basket) и каталогом всех товаров (catalog), а также данными о заказе клиента (orderDetails).

**Свойства класса AppState:**

- basket: Массив объектов Product, представляющих товары в корзине.
- catalog: Массив объектов Product, представляющих все товары в магазине.

**Методы класса AppState:**

- setProductList(items: IProduct[]): Устанавливает список товаров в каталоге.
- orderDetails: Объект, содержащий данные о заказе клиента, включая список товаров, способ оплаты, общую стоимость, адрес, электронную почту и номер телефона.
- order: Объект, содержащий данные о форме заказа (не отображен в приведенном фрагменте).
- formErrors: объект с ошибками, возникшими при заполнении форм.

**Методы работы с корзиной:**

- addProductToBasket(value: Product): Добавляет товар в корзину.
- removeProductFromBasket(id: string): Удаляет товар из корзины по его идентификатору.
- getBasketCount(): Возвращает количество товаров в корзине.
- setOrderedItems(): Устанавливает список товаров, заказанных клиентом.
- getBasketTotal(): Возвращает общую стоимость товаров в корзине.
- clearBasket(): Очищает корзину.

**Работа с полями формы заказа:**

- setOrderField(field: keyof IOrderForm, value: string): Устанавливает значение указанного поля в объекте order.
- validateOrder: Валидирует поля заказа (адрес).
- validateContacts: Валидирует контактную информацию (email и телефон).
  Эти методы проверяют, заполнены ли обязательные поля, и возвращают объект с ошибками валидации. Если ошибок нет, они вызывают события order:ready и contacts:ready соответственно, передавая в них объект заказа.

## 4. AppAPI

**Интерфейс IAppAPI:**
Интерфейс IAppAPI определяет методы для взаимодействия с API приложения:

- getProductList: Получает список продуктов.
- postOrderProduct: Создает заказ на продукт.

**Конструктор**
Конструктор AppAPI принимает следующие параметры:

- cdn: URL-адрес CDN для загрузки изображений продуктов.
- baseUrl: Базовый URL-адрес API.
- options: Дополнительные опции для запросов (по умолчанию пустой объект).

**Методы**

- getProductList: Возвращает список продуктов из API. Полученные изображения продукта преобразуются с использованием URL-адреса CDN.
- postOrderProduct: Отправляет заказ на продукт на сервер и возвращает результат.

## IEvents

**Описание**
IEvents - это интерфейс, определяющий простой брокер событий.

**Методы:**

- on: Подписывается на событие с помощью обратного вызова.
- emit: Инициирует событие с необязательными данными.
- trigger: Возвращает функцию, которая при вызове генерирует событие.

## EventEmitter

EventEmitter - это реализация IEvents, которая использует внутреннюю карту для хранения подписчиков для каждого события. Он предоставляет следующие дополнительные **методы**:

- off: Отписывается от события с помощью обратного вызова.
- onAll: Подписывается на все события с помощью обратного вызова.
- offAll: Отписывается от всех событий.

## Api

**Типы данных**

**ApiResponseList<Type>**: Тип, представляющий ответ API со списком элементов.

Он содержит следующие **свойства**:

- total: Общее количество элементов.
- items: Массив элементов.

**ApiPostMethods**: Тип, представляющий методы HTTP POST запросов, поддерживаемые этим API:

- 'POST'
- 'PUT'
- 'DELETE'

**Конструктор**
Конструктор Api принимает следующие параметры:

- baseUrl: Базовый URL-адрес API.
- options: Дополнительные параметры запроса (по умолчанию пустой объект).

**Методы**

- handleResponse: Обрабатывает ответ сервера и извлекает данные JSON. Если ответ не является успешным (код статуса не равен 200), он возвращает отклоненный промис с сообщением об ошибке.
- get: Выполняет HTTP GET запрос и возвращает промис с данными ответа API.
- post: Выполняет HTTP POST, PUT или DELETE запрос и возвращает промис с данными ответа API. Метод запроса по умолчанию - 'POST', но его можно переопределить с помощью параметра method.

# Основные типы/интерфейсы проекта

В приложении используются следующие типы данных:

- `IProduct`: Определяет структуру данных товара.
- `IOrder`: Определяет структуру данных заказа.
- `IEvents`: Определяет интерфейс для работы с событиями.
- `IModalData`: Определяет структуру данных для модального окна.
- `IProductCardActions`: Определяет структуру данных для действий с карточкой товара.
- `IForm`: Определяет структуру данных для формы.
- `ISuccess`: Определяет структуру данных для сообщения об успешном действии.
- `IOrderForm`: Определяет структуру данных для формы заказа.
- `IAppAPI`: Определяет интерфейс для взаимодействия с API приложения.
- `IEvents`: Определяет интерфейс для работы с событиями.
- `ApiResponseList`: Определяет структуру данных для ответа API с списком элементов.
- `ApiPostMethods`: Определяет типы методов HTTP POST запросов, поддерживаемых API.
